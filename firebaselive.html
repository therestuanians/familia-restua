<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Chat</title>
    <style>
        /* Basic styling for the chat application */
        #messages {
            border: 1px solid #ccc;
            height: 300px;
            overflow-y: scroll;
            padding: 10px;
            margin-bottom: 10px;
        }
        #chatInput {
            display: flex;
        }
        #messageText {
            flex: 1;
            padding: 10px;
        }
        #sendButton {
            padding: 10px;
        }
    </style>
</head>
<body>

<h1>Live Chat</h1>

<div id="messages"></div>

<div id="chatInput">
    <input type="text" id="nameInput" placeholder="Your name" required>
    <input type="text" id="messageText" placeholder="Type a message..." required>
    <button id="sendButton">Send</button>
</div>

<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, orderBy, query } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyBW9I8ZpGQCYZH5n-us71Cfb_yunGMPCUs",
        authDomain: "live-chat-testing-95232.firebaseapp.com",
        projectId: "live-chat-testing-95232",
        storageBucket: "live-chat-testing-95232.appspot.com",
        messagingSenderId: "982255648611",
        appId: "1:982255648611:web:da1255ce3152061e8a1d56"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Function to send a message
    const sendMessage = async () => {
        const nameInput = document.getElementById('nameInput');
        const messageInput = document.getElementById('messageText');

        const senderName = nameInput.value;
        const messageText = messageInput.value;

        if (senderName && messageText) {
            try {
                await addDoc(collection(db, 'messages'), {
                    senderName: senderName,
                    text: messageText,
                    timestamp: new Date() // Set the current date and time
                });
                messageInput.value = ''; // Clear the message input after sending
            } catch (e) {
                console.error("Error adding document: ", e);
            }
        }
    };

    // Function to display messages
    const displayMessages = () => {
        const messagesDiv = document.getElementById('messages');
        const q = query(collection(db, 'messages'), orderBy('timestamp'));

        onSnapshot(q, (querySnapshot) => {
            messagesDiv.innerHTML = ''; // Clear existing messages
            querySnapshot.forEach((doc) => {
                const msg = doc.data();
                const messageElement = document.createElement('div');
                messageElement.textContent = `${msg.senderName}: ${msg.text}`;
                messagesDiv.appendChild(messageElement);
            });
            messagesDiv.scrollTop = messagesDiv.scrollHeight; // Scroll to bottom
        });
    };

    // Save the user's name to local storage
    const nameInput = document.getElementById('nameInput');
    nameInput.addEventListener('input', () => {
        localStorage.setItem('username', nameInput.value);
    });

    // Load the user's name from local storage when the page loads
    window.onload = () => {
        const savedName = localStorage.getItem('username');
        if (savedName) {
            nameInput.value = savedName;
        }
    };

    // Event listener for the send button
    document.getElementById('sendButton').addEventListener('click', sendMessage);

    // Call the function to start displaying messages
    displayMessages();
</script>

</body>
</html>
